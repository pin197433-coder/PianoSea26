<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’¢ç´æµ· - Piano Sea</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            padding-bottom: 220px;
        }
        .container { max-width: 100%; padding: 20px; }
        header { text-align: center; padding: 20px 0; }
        h1 { font-size: 2em; margin-bottom: 5px; }

        .card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            width: calc(100% - 10px);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            font-size: 0.9em;
            padding: 8px 20px;
            width: auto;
        }

        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 10px 0; }
        .item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .item.active {
            border-color: white;
            background: rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }

        .status {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .track-info {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .error { color: #ff6b6b; font-size: 0.85em; margin-top: 5px; }
        .success { color: #4ade80; font-size: 0.85em; margin-top: 5px; }

        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            z-index: 1000;
        }

        .timer { font-size: 2.5em; text-align: center; margin-bottom: 10px; }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1.2em;
            cursor: pointer;
        }

        .play-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-size: 1.5em;
        }

        .volume-container {
            display: flex;
            gap: 10px;
            justify-content: space-around;
        }

        .volume-item { flex: 1; text-align: center; }
        input[type="range"] { width: 100%; margin-top: 5px; }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¹ é’¢ç´æµ·</h1>
            <p>ä¸€é”®æ”¾æ¾ï¼Œä¸æµ·å…±ç”Ÿ</p>
        </header>

        <div class="card">
            <div style="font-weight: bold; margin-bottom: 10px;">ğŸŒŠ é€‰æ‹©æµ·åŸŸ</div>
            <div class="grid">
                <div class="item active" onclick="setOcean('mediterranean')">åœ°ä¸­æµ·<br><small>è½»æŸ”</small></div>
                <div class="item" onclick="setOcean('atlantic')">å¤§è¥¿æ´‹<br><small>èˆ’ç¼“</small></div>
                <div class="item" onclick="setOcean('pacific')">å¤ªå¹³æ´‹<br><small>æ²»æ„ˆ</small></div>
            </div>
        </div>

        <div class="card">
            <div style="font-weight: bold; margin-bottom: 10px;">ğŸ­ é€‰æ‹©åœºæ™¯</div>
            <div class="grid">
                <div class="item active" onclick="setScene('anxiety')">ç„¦è™‘æ€¥æ•‘<br><small>3é¦–</small></div>
                <div class="item" onclick="setScene('focus')">é™å¿ƒä¸“æ³¨<br><small>3é¦–</small></div>
                <div class="item" onclick="setScene('sleep')">ç¡å‰åŠ©çœ <br><small>3é¦–</small></div>
                <div class="item" onclick="setScene('nap')">åˆä¼‘å°æ†©<br><small>3é¦–</small></div>
            </div>
        </div>

        <div class="card">
            <div style="font-weight: bold; margin-bottom: 10px;">ğŸŒ é€‰æ‹©è¯­è¨€</div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" style="flex: 1; min-width: 80px;" onclick="setLang('zh')">æ™®é€šè¯</button>
                <button class="btn" style="flex: 1; min-width: 80px;" onclick="setLang('hk')">ç²¤è¯­</button>
                <button class="btn" style="flex: 1; min-width: 80px;" onclick="setLang('en')">English</button>
            </div>
        </div>

        <div class="card">
            <div class="track-info">
                <span>ğŸ¹ å½“å‰ï¼š<span id="currentTrack">æœªæ’­æ”¾</span></span>
                <button class="btn-secondary" onclick="nextPiano()">æ¢ä¸€é¦– â†»</button>
            </div>

            <div class="status" id="statusText">å‡†å¤‡å°±ç»ª</div>
            <div id="errorText" class="error"></div>
            <div id="successText" class="success"></div>

            <button class="btn" id="mainBtn" onclick="togglePlay()" style="margin-top: 10px;">
                â–¶ï¸ å¼€å§‹æ”¾æ¾
            </button>
        </div>
    </div>

    <div class="player">
        <div class="timer" id="timerDisplay">15:00</div>
        <div class="controls">
            <button class="control-btn" onclick="stopAll()">â¹</button>
            <button class="control-btn play-btn" id="playBtn" onclick="togglePlay()">â–¶</button>
            <button class="control-btn" onclick="toggleMute()">ğŸ”Š</button>
        </div>
        <div class="volume-container">
            <div class="volume-item">
                <div>ğŸ¹ é’¢ç´</div>
                <input type="range" id="volPiano" min="0" max="100" value="70" oninput="updateVolumes()">
            </div>
            <div class="volume-item">
                <div>ğŸŒŠ æµ·æµª</div>
                <input type="range" id="volWave" min="0" max="100" value="50" oninput="updateVolumes()">
            </div>
            <div class="volume-item">
                <div>ğŸ™ï¸ è¯­éŸ³</div>
                <input type="range" id="volVoice" min="0" max="100" value="80" oninput="updateVolumes()">
            </div>
        </div>
    </div>

    <script>
        // ===== å®é™…éŸ³é¢‘æ–‡ä»¶é…ç½®ï¼ˆå®Œå…¨åŒ¹é…ä½ çš„æ–‡ä»¶åï¼‰ =====
        const PIANO_FILES = {
            anxiety: [  // ç„¦è™‘æ€¥æ•‘ - 3é¦–
                'piano_anxiety_BackgroundDocumentary.mp3',
                'piano_anxiety_CalmWaves.mp3',
                'piano_anxiety_emotional.mp3'
            ],
            focus: [    // é™å¿ƒä¸“æ³¨ - 3é¦–
                'piano_focus_minimalisticPrelude.mp3',
                'piano_focus_scarboroughFair.mp3',
                'piano_focus_variatio14a2clav.mp3'
            ],
            sleep: [    // ç¡å‰åŠ©çœ  - 3é¦–
                'piano_sleep_SoftPiano.mp3',
                'piano_sleep_SoftPiano2.mp3',
                'piano_sleep_daylight.mp3'
            ],
            nap: [      // åˆä¼‘å°æ†© - 3é¦–
                'piano_nap_Inspiring.mp3',
                'piano_nap_cafeJazz.mp3',
                'piano_nap_morningZen.mp3'
            ]
        };

        const WAVE_FILES = {
            mediterranean: 'audio/wave1.mp3',
            atlantic: 'audio/wave2.mp3',
            pacific: 'audio/wave.mp3'  // wave.mp3 ä½œä¸ºå¤ªå¹³æ´‹
        };

        const VOICE_FILES = {
            anxiety: { zh: 'audio/ç„¦è™‘æ€¥æ•‘-æ™®é€šè¯.mp3', hk: 'audio/ç„¦è™‘æ€¥æ•‘-ç²¤è¯­.mp3', en: 'audio/ç„¦è™‘æ€¥æ•‘-è‹±è¯­.mp3' },
            focus: { zh: 'audio/é™å¿ƒä¸“æ³¨-æ™®é€šè¯.mp3', hk: 'audio/é™å¿ƒä¸“æ³¨-ç²¤è¯­.mp3', en: 'audio/é™å¿ƒä¸“æ³¨-è‹±è¯­.mp3' },
            sleep: { zh: 'audio/ç¡å‰åŠ©çœ -æ™®é€šè¯.mp3', hk: 'audio/ç¡å‰åŠ©çœ -ç²¤è¯­.mp3', en: 'audio/ç¡å‰åŠ©çœ -è‹±è¯­.mp3' },
            nap: { zh: 'audio/åˆä¼‘å°æ†©-æ™®é€šè¯.mp3', hk: 'audio/åˆä¼‘å°æ†©-ç²¤è¯­.mp3', en: 'audio/åˆä¼‘å°æ†©-è‹±è¯­.mp3' }
        };

        let state = {
            isPlaying: false,
            isMuted: false,
            ocean: 'mediterranean',
            scene: 'anxiety',
            lang: 'zh',
            currentPianoIndex: 0
        };

        let audio = {};
        let timer = null;
        let remaining = 15 * 60;

        function getRandomIndex(scene) {
            return Math.floor(Math.random() * PIANO_FILES[scene].length);
        }

        function getCurrentPianoPath() {
            return 'audio/' + PIANO_FILES[state.scene][state.currentPianoIndex];
        }

        function updateTrackDisplay() {
            const file = PIANO_FILES[state.scene][state.currentPianoIndex];
            const shortName = file.replace('piano_' + state.scene + '_', '').replace('.mp3', '');
            document.getElementById('currentTrack').textContent = 
                shortName + ' (' + (state.currentPianoIndex + 1) + '/' + PIANO_FILES[state.scene].length + ')';
        }

        function nextPiano() {
            const len = PIANO_FILES[state.scene].length;
            state.currentPianoIndex = (state.currentPianoIndex + 1) % len;

            if (audio.piano && state.isPlaying) {
                audio.piano.src = getCurrentPianoPath();
                audio.piano.play().catch(() => {});
            }
            updateTrackDisplay();
            showSuccess('åˆ‡æ¢åˆ°: ' + PIANO_FILES[state.scene][state.currentPianoIndex].replace('.mp3', ''));
        }

        async function togglePlay() {
            if (state.isPlaying) {
                pauseAll();
                state.isPlaying = false;
                updateUI();
                clearInterval(timer);
                return;
            }

            showError('');
            showSuccess('åŠ è½½ä¸­...');

            try {
                // åˆå§‹åŒ–é’¢ç´ï¼ˆéšæœºé€‰æ‹©ï¼‰
                if (!audio.piano) {
                    state.currentPianoIndex = getRandomIndex(state.scene);
                    audio.piano = new Audio(getCurrentPianoPath());
                    audio.piano.loop = true;
                    audio.piano.volume = document.getElementById('volPiano').value / 100;
                    updateTrackDisplay();
                }

                // åˆå§‹åŒ–æµ·æµª
                if (!audio.wave) {
                    audio.wave = new Audio(WAVE_FILES[state.ocean]);
                    audio.wave.loop = true;
                    audio.wave.volume = document.getElementById('volWave').value / 100;
                }

                // åˆå§‹åŒ–è¯­éŸ³
                if (!audio.voice) {
                    audio.voice = new Audio(VOICE_FILES[state.scene][state.lang]);
                    audio.voice.volume = document.getElementById('volVoice').value / 100;
                }

                // æ’­æ”¾
                await Promise.all([
                    audio.piano.play().catch(e => { 
                        showError('é’¢ç´å¤±è´¥: ' + e.message + '. æ–‡ä»¶å: ' + getCurrentPianoPath()); 
                        return false; 
                    }),
                    audio.wave.play().catch(e => { 
                        showError('æµ·æµªå¤±è´¥: ' + e.message); 
                        return false; 
                    }),
                    audio.voice.play().catch(e => { 
                        showError('è¯­éŸ³å¤±è´¥: ' + e.message); 
                        return false; 
                    })
                ]);

                state.isPlaying = true;
                updateUI();
                startTimer();
                showSuccess('å¼€å§‹æ’­æ”¾ï¼');

            } catch (err) {
                showError('æ’­æ”¾é”™è¯¯: ' + err.message);
            }
        }

        function pauseAll() {
            if (audio.piano) audio.piano.pause();
            if (audio.wave) audio.wave.pause();
            if (audio.voice) audio.voice.pause();
        }

        function stopAll() {
            pauseAll();
            if (audio.piano) { audio.piano.currentTime = 0; audio.piano = null; }
            if (audio.wave) { audio.wave.currentTime = 0; audio.wave = null; }
            if (audio.voice) { audio.voice.currentTime = 0; audio.voice = null; }
            state.isPlaying = false;
            remaining = 15 * 60;
            updateTimer();
            updateUI();
            clearInterval(timer);
            document.getElementById('currentTrack').textContent = 'æœªæ’­æ”¾';
        }

        function toggleMute() {
            state.isMuted = !state.isMuted;
            Object.values(audio).forEach(a => { if (a) a.muted = state.isMuted; });
        }

        function updateVolumes() {
            if (audio.piano) audio.piano.volume = document.getElementById('volPiano').value / 100;
            if (audio.wave) audio.wave.volume = document.getElementById('volWave').value / 100;
            if (audio.voice) audio.voice.volume = document.getElementById('volVoice').value / 100;
        }

        function setOcean(ocean) {
            state.ocean = ocean;
            updateSelection();
            if (audio.wave) {
                audio.wave.src = WAVE_FILES[ocean];
                if (state.isPlaying) audio.wave.play().catch(() => {});
            }
            updateStatus();
        }

        function setScene(scene) {
            state.scene = scene;
            state.currentPianoIndex = 0;
            updateSelection();
            if (audio.piano) audio.piano = null;
            if (audio.voice) audio.voice = null;
            if (state.isPlaying) {
                stopAll();
                setTimeout(togglePlay, 300);
            } else {
                updateTrackDisplay();
            }
            updateStatus();
        }

        function setLang(lang) {
            state.lang = lang;
            if (audio.voice) audio.voice = null;
            if (state.isPlaying) {
                stopAll();
                setTimeout(togglePlay, 300);
            }
            updateStatus();
        }

        function updateSelection() {
            document.querySelectorAll('.item').forEach((el, idx) => {
                el.classList.remove('active');
                const scenes = ['anxiety', 'focus', 'sleep', 'nap'];
                const oceans = ['mediterranean', 'atlantic', 'pacific'];
                if (idx < 3 && oceans[idx] === state.ocean) el.classList.add('active');
                if (idx >= 3 && scenes[idx-3] === state.scene) el.classList.add('active');
            });
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                remaining--;
                updateTimer();
                if (remaining <= 0) {
                    stopAll();
                    alert('æ—¶é—´ç»“æŸï¼');
                }
            }, 1000);
        }

        function updateTimer() {
            const m = Math.floor(remaining / 60).toString().padStart(2, '0');
            const s = (remaining % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `${m}:${s}`;
        }

        function updateStatus() {
            const names = {
                ocean: { mediterranean: 'åœ°ä¸­æµ·', atlantic: 'å¤§è¥¿æ´‹', pacific: 'å¤ªå¹³æ´‹' },
                scene: { anxiety: 'ç„¦è™‘æ€¥æ•‘', focus: 'é™å¿ƒä¸“æ³¨', sleep: 'ç¡å‰åŠ©çœ ', nap: 'åˆä¼‘å°æ†©' },
                lang: { zh: 'æ™®é€šè¯', hk: 'ç²¤è¯­', en: 'è‹±è¯­' }
            };
            document.getElementById('statusText').textContent = 
                `${names.ocean[state.ocean]} | ${names.scene[state.scene]} | ${names.lang[state.lang]}`;
        }

        function updateUI() {
            document.getElementById('mainBtn').textContent = state.isPlaying ? 'â¸ï¸ æš‚åœæ”¾æ¾' : 'â–¶ï¸ å¼€å§‹æ”¾æ¾';
            document.getElementById('playBtn').textContent = state.isPlaying ? 'â¸' : 'â–¶';
        }

        function showError(msg) { 
            document.getElementById('errorText').textContent = msg; 
        }
        function showSuccess(msg) { 
            const el = document.getElementById('successText');
            el.textContent = msg; 
            setTimeout(() => el.textContent = '', 3000);
        }

        // åˆå§‹åŒ–
        updateStatus();
        updateTrackDisplay();
    </script>
</body>
</html>