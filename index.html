<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’¢ç´æµ· - Piano Sea</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .language-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .lang-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid transparent;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .lang-btn:hover, .lang-btn.active {
            background: rgba(255,255,255,0.9);
            color: #2a5298;
            transform: translateY(-2px);
        }
        
        .scene-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .scene-card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            backdrop-filter: blur(10px);
        }
        
        .scene-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
        }
        
        .scene-card.active {
            background: rgba(255,255,255,0.9);
            color: #2a5298;
            border-color: #fff;
        }
        
        .scene-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .player-controls {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .control-label {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
        }
        
        .slider-container {
            flex: 1;
            margin-left: 20px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.3);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .timer-display {
            font-size: 3em;
            text-align: center;
            margin: 20px 0;
            font-weight: 300;
            letter-spacing: 2px;
        }
        
        .timer-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .time-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid transparent;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-btn:hover, .time-btn.active {
            background: rgba(255,255,255,0.9);
            color: #2a5298;
        }
        
        .main-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .main-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .feedback-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .feedback-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            background: transparent;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .feedback-btn:hover {
            background: rgba(255,255,255,0.9);
            color: #2a5298;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .admin-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .admin-title {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .input-group input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .security-info {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .security-item {
            text-align: center;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .audio-status {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .playing {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .wave-animation {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="wave-animation"></div>
    
    <div class="container">
        <header>
            <h1>ğŸ¹ é’¢ç´æµ·</h1>
            <p class="subtitle" data-lang="subtitle">ä¸€é”®æ”¾æ¾ï¼Œä¸æµ·å…±ç”Ÿ</p>
        </header>
        
        <div class="language-selector">
            <button class="lang-btn active" onclick="changeLang('zh')">ğŸ‡¨ğŸ‡³ æ™®é€šè¯</button>
            <button class="lang-btn" onclick="changeLang('hk')">ğŸ‡­ğŸ‡° ç²¤è¯­</button>
            <button class="lang-btn" onclick="changeLang('en')">ğŸ‡¬ğŸ‡§ English</button>
            <button class="lang-btn" onclick="changeLang('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
            <button class="lang-btn" onclick="changeLang('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        </div>
        
        <div class="scene-grid">
            <div class="scene-card" onclick="selectScene('sleep', this)">
                <div class="scene-icon">ğŸŒ™</div>
                <div data-lang="sleep">æ·±åº¦ç¡çœ </div>
            </div>
            <div class="scene-card" onclick="selectScene('focus', this)">
                <div class="scene-icon">ğŸ¯</div>
                <div data-lang="focus">ä¸“æ³¨å·¥ä½œ</div>
            </div>
            <div class="scene-card" onclick="selectScene('relax', this)">
                <div class="scene-icon">ğŸ§˜</div>
                <div data-lang="relax">å†¥æƒ³æ”¾æ¾</div>
            </div>
            <div class="scene-card" onclick="selectScene('read', this)">
                <div class="scene-icon">ğŸ“–</div>
                <div data-lang="read">é˜…è¯»æ—¶å…‰</div>
            </div>
        </div>
        
        <div class="audio-status" id="audioStatus">
            <span data-lang="ready">å‡†å¤‡å°±ç»ª - ç‚¹å‡»å¼€å§‹æ’­æ”¾</span>
        </div>
        
        <div class="player-controls">
            <div class="control-row">
                <span class="control-label">ğŸŒŠ <span data-lang="wave">æµ·æµªéŸ³é‡</span></span>
                <div class="slider-container">
                    <input type="range" id="waveVolume" min="0" max="100" value="50" oninput="updateVolume('wave', this.value)">
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">ğŸ¹ <span data-lang="piano">é’¢ç´éŸ³é‡</span></span>
                <div class="slider-container">
                    <input type="range" id="pianoVolume" min="0" max="100" value="70" oninput="updateVolume('piano', this.value)">
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">ğŸ™ï¸ <span data-lang="voice">è¯­éŸ³å¼•å¯¼</span></span>
                <div class="slider-container">
                    <input type="range" id="voiceVolume" min="0" max="100" value="30" oninput="updateVolume('voice', this.value)">
                </div>
            </div>
        </div>
        
        <div class="timer-display" id="timerDisplay">25:00</div>
        
        <div class="timer-options">
            <button class="time-btn" onclick="setTimer(15)">15<span data-lang="min">åˆ†é’Ÿ</span></button>
            <button class="time-btn active" onclick="setTimer(25)">25<span data-lang="min">åˆ†é’Ÿ</span></button>
            <button class="time-btn" onclick="setTimer(30)">30<span data-lang="min">åˆ†é’Ÿ</span></button>
            <button class="time-btn" onclick="setTimer(60)">60<span data-lang="min">åˆ†é’Ÿ</span></button>
        </div>
        
        <button class="main-btn" id="startBtn" onclick="toggleTimer()">
            <span data-lang="start">å¼€å§‹æ”¾æ¾ä¹‹æ—…</span>
        </button>
        
        <div class="feedback-section">
            <a href="https://forms.gle/r6znYF8Pr5ffVmAv9" target="_blank" class="feedback-btn">
                <span>ğŸ’¬</span>
                <span data-lang="feedback">æ„è§åé¦ˆ</span>
            </a>
            <p style="text-align: center; margin-top: 10px; font-size: 0.85em; opacity: 0.7;" data-lang="feedbackDesc">
                æ‚¨çš„å»ºè®®å¸®åŠ©æˆ‘ä»¬åšå¾—æ›´å¥½
            </p>
        </div>
        
        <div class="admin-section">
            <div class="admin-title" data-lang="admin">å®‰å…¨æ•°æ®ç®¡ç†åŒºåŸŸ</div>
            <div id="adminLogin">
                <div class="input-group">
                    <input type="text" id="username" placeholder="ç”¨æˆ·å" data-lang-placeholder="username">
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="å¯†ç " data-lang-placeholder="password">
                </div>
                <button class="main-btn" onclick="adminLogin()" style="font-size: 1em;">
                    <span data-lang="login">ç®¡ç†å‘˜ç™»å½•</span>
                </button>
            </div>
            <div id="adminPanel" class="hidden">
                <p style="text-align: center; margin-bottom: 15px;">
                    <span data-lang="welcome">æ¬¢è¿</span> <span id="adminName"></span>
                    <span class="status-badge">å·²ç™»å½•</span>
                </p>
                <button class="main-btn" onclick="viewData()" style="font-size: 1em; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <span data-lang="viewData">æŸ¥çœ‹åé¦ˆæ•°æ®</span>
                </button>
                <button class="main-btn" onclick="adminLogout()" style="font-size: 0.9em; background: rgba(255,255,255,0.2); margin-top: 10px;">
                    <span data-lang="logout">é€€å‡ºç™»å½•</span>
                </button>
            </div>
            <div class="security-info">
                <div class="security-item">
                    <div>24h</div>
                    <div style="font-size: 0.8em;" data-lang="session">ä¼šè¯è¿‡æœŸ</div>
                </div>
                <div class="security-item">
                    <div>AES</div>
                    <div style="font-size: 0.8em;" data-lang="encrypt">æ•°æ®åŠ å¯†</div>
                </div>
                <div class="security-item">
                    <div>180<span data-lang="days">å¤©</span></div>
                    <div style="font-size: 0.8em;" data-lang="retain">æ•°æ®ä¿ç•™</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å¤šè¯­è¨€æ”¯æŒ
        const translations = {
            zh: {
                subtitle: "ä¸€é”®æ”¾æ¾ï¼Œä¸æµ·å…±ç”Ÿ",
                sleep: "æ·±åº¦ç¡çœ ",
                focus: "ä¸“æ³¨å·¥ä½œ",
                relax: "å†¥æƒ³æ”¾æ¾",
                read: "é˜…è¯»æ—¶å…‰",
                wave: "æµ·æµªéŸ³é‡",
                piano: "é’¢ç´éŸ³é‡",
                voice: "è¯­éŸ³å¼•å¯¼",
                min: "åˆ†é’Ÿ",
                start: "å¼€å§‹æ”¾æ¾ä¹‹æ—…",
                pause: "æš‚åœ",
                ready: "å‡†å¤‡å°±ç»ª - ç‚¹å‡»å¼€å§‹æ’­æ”¾",
                playing: "æ­£åœ¨æ’­æ”¾...",
                feedback: "æ„è§åé¦ˆ",
                feedbackDesc: "æ‚¨çš„å»ºè®®å¸®åŠ©æˆ‘ä»¬åšå¾—æ›´å¥½",
                admin: "å®‰å…¨æ•°æ®ç®¡ç†åŒºåŸŸ",
                username: "ç”¨æˆ·å",
                password: "å¯†ç ",
                login: "ç®¡ç†å‘˜ç™»å½•",
                welcome: "æ¬¢è¿",
                viewData: "æŸ¥çœ‹åé¦ˆæ•°æ®",
                logout: "é€€å‡ºç™»å½•",
                session: "ä¼šè¯è¿‡æœŸ",
                encrypt: "æ•°æ®åŠ å¯†",
                retain: "æ•°æ®ä¿ç•™",
                days: "å¤©"
            },
            hk: {
                subtitle: "ä¸€éµæ”¾é¬†ï¼Œèˆ‡æµ·å…±ç”Ÿ",
                sleep: "æ·±åº¦ç¡çœ ",
                focus: "å°ˆæ³¨å·¥ä½œ",
                relax: "å†¥æƒ³æ”¾é¬†",
                read: "é–±è®€æ™‚å…‰",
                wave: "æµ·æµªéŸ³é‡",
                piano: "é‹¼ç´éŸ³é‡",
                voice: "èªéŸ³å¼•å°",
                min: "åˆ†é˜",
                start: "é–‹å§‹æ”¾é¬†ä¹‹æ—…",
                pause: "æš«åœ",
                ready: "æº–å‚™å°±ç·’ - é»æ“Šé–‹å§‹æ’­æ”¾",
                playing: "æ­£åœ¨æ’­æ”¾...",
                feedback: "æ„è¦‹åé¥‹",
                feedbackDesc: "æ‚¨çš„å»ºè­°å¹«åŠ©æˆ‘å€‘åšå¾—æ›´å¥½",
                admin: "å®‰å…¨æ•¸æ“šç®¡ç†å€åŸŸ",
                username: "ç”¨æˆ¶å",
                password: "å¯†ç¢¼",
                login: "ç®¡ç†å“¡ç™»éŒ„",
                welcome: "æ­¡è¿",
                viewData: "æŸ¥çœ‹åé¥‹æ•¸æ“š",
                logout: "é€€å‡ºç™»éŒ„",
                session: "æœƒè©±éæœŸ",
                encrypt: "æ•¸æ“šåŠ å¯†",
                retain: "æ•¸æ“šä¿ç•™",
                days: "å¤©"
            },
            en: {
                subtitle: "Relax with One Click, Live with the Sea",
                sleep: "Deep Sleep",
                focus: "Focus Work",
                relax: "Meditation",
                read: "Reading Time",
                wave: "Wave Volume",
                piano: "Piano Volume",
                voice: "Voice Guide",
                min: "min",
                start: "Start Journey",
                pause: "Pause",
                ready: "Ready - Click to start",
                playing: "Playing...",
                feedback: "Feedback",
                feedbackDesc: "Your suggestions help us improve",
                admin: "Secure Data Management",
                username: "Username",
                password: "Password",
                login: "Admin Login",
                welcome: "Welcome",
                viewData: "View Feedback Data",
                logout: "Logout",
                session: "Session Expires",
                encrypt: "Encrypted",
                retain: "Data Retention",
                days: "days"
            },
            es: {
                subtitle: "RelÃ¡jese con un Clic, Viva con el Mar",
                sleep: "SueÃ±o Profundo",
                focus: "Trabajo Focalizado",
                relax: "MeditaciÃ³n",
                read: "Tiempo de Lectura",
                wave: "Volumen de Olas",
                piano: "Volumen de Piano",
                voice: "GuÃ­a de Voz",
                min: "min",
                start: "Comenzar Viaje",
                pause: "Pausa",
                ready: "Listo - Haga clic para iniciar",
                playing: "Reproduciendo...",
                feedback: "Comentarios",
                feedbackDesc: "Sus sugerencias nos ayudan a mejorar",
                admin: "GestiÃ³n Segura de Datos",
                username: "Usuario",
                password: "ContraseÃ±a",
                login: "Inicio de Admin",
                welcome: "Bienvenido",
                viewData: "Ver Datos de Comentarios",
                logout: "Cerrar SesiÃ³n",
                session: "SesiÃ³n Expira",
                encrypt: "Encriptado",
                retain: "RetenciÃ³n de Datos",
                days: "dÃ­as"
            },
            ar: {
                subtitle: "Ø§Ø³ØªØ±Ø®Ù Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©ØŒ Ø¹ÙØ´ Ù…Ø¹ Ø§Ù„Ø¨Ø­Ø±",
                sleep: "Ù†ÙˆÙ… Ø¹Ù…ÙŠÙ‚",
                focus: "Ø¹Ù…Ù„ Ù…Ø±ÙƒØ²",
                relax: "ØªØ£Ù…Ù„",
                read: "ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",
                wave: "ØµÙˆØª Ø§Ù„Ø£Ù…ÙˆØ§Ø¬",
                piano: "ØµÙˆØª Ø§Ù„Ø¨ÙŠØ§Ù†Ùˆ",
                voice: "Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„ØµÙˆØªÙŠ",
                min: "Ø¯Ù‚ÙŠÙ‚Ø©",
                start: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©",
                pause: "Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª",
                ready: "Ø¬Ø§Ù‡Ø² - Ø§Ù†Ù‚Ø± Ù„Ù„Ø¨Ø¯Ø¡",
                playing: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„...",
                feedback: "ØªØ¹Ù„ÙŠÙ‚Ø§Øª",
                feedbackDesc: "Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ ØªØ³Ø§Ø¹Ø¯Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø³Ù†",
                admin: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù…Ù†Ø©",
                username: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
                password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                login: "ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„",
                welcome: "Ø£Ù‡Ù„Ø§Ù‹",
                viewData: "Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª",
                logout: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
                session: "Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©",
                encrypt: "Ù…Ø´ÙØ±",
                retain: "Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                days: "ÙŠÙˆÙ…"
            }
        };
        
        let currentLang = 'zh';
        let timerInterval;
        let timeLeft = 25 * 60;
        let isRunning = false;
        let currentScene = '';
        let audioContext = null;
        let waveNode = null;
        let pianoInterval = null;
        let voiceTimeout = null;
        
        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆå¿…é¡»ç”¨æˆ·äº¤äº’åæ‰èƒ½åˆ›å»ºï¼‰
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }
        
        // ç”Ÿæˆæµ·æµªå£°ï¼ˆä½¿ç”¨å™ªå£°ç¼“å†²åŒºï¼‰
        function createWaveSound() {
            if (!audioContext) return;
            
            const bufferSize = 2 * audioContext.sampleRate;
            const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                // ç²‰çº¢å™ªå£°ç®—æ³•ï¼Œæ›´æ¥è¿‘æµ·æµªå£°
                const white = Math.random() * 2 - 1;
                output[i] = (lastOut + (0.02 * white)) / 1.02;
                lastOut = output[i];
                output[i] *= 3.5;
            }
            
            const noise = audioContext.createBufferSource();
            noise.buffer = noiseBuffer;
            noise.loop = true;
            
            const gainNode = audioContext.createGain();
            gainNode.gain.value = document.getElementById('waveVolume').value / 100;
            
            // æ·»åŠ æ»¤æ³¢å™¨è®©å£°éŸ³æ›´ä½æ²‰ï¼ˆæ›´åƒæµ·æµªï¼‰
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400;
            
            noise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            noise.start(0);
            waveNode = { source: noise, gain: gainNode };
        }
        
        let lastOut = 0;
        
        // ç”Ÿæˆé’¢ç´å£°ï¼ˆä½¿ç”¨æŒ¯è¡å™¨æ¨¡æ‹Ÿï¼‰
        function playPianoNote(frequency, duration, delay) {
            if (!audioContext) return;
            
            setTimeout(() => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                
                // é’¢ç´åŒ…ç»œ
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(
                    document.getElementById('pianoVolume').value / 100 * 0.3, 
                    audioContext.currentTime + 0.02
                );
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }, delay);
        }
        
        // æ’­æ”¾é’¢ç´æ—‹å¾‹
        function startPianoMusic() {
            if (!audioContext) return;
            
            const melodies = {
                sleep: [261.63, 293.66, 329.63, 349.23], // Cå¤§è°ƒå’Œå¼¦
                focus: [440, 554.37, 659.25, 440], // Aå¤§è°ƒ
                relax: [329.63, 392, 493.88, 392], // Eå¤§è°ƒ
                read: [349.23, 440, 523.25, 440]  // Få¤§è°ƒ
            };
            
            const notes = melodies[currentScene] || melodies.relax;
            let noteIndex = 0;
            
            pianoInterval = setInterval(() => {
                playPianoNote(notes[noteIndex % notes.length], 2, 0);
                playPianoNote(notes[(noteIndex + 2) % notes.length], 1.5, 500);
                noteIndex++;
            }, 4000); // æ¯4ç§’æ’­æ”¾ä¸€æ¬¡å’Œå¼¦
        }
        
        // è¯­éŸ³å¼•å¯¼ï¼ˆä½¿ç”¨ç®€å•çš„æç¤ºéŸ³ä»£æ›¿ï¼Œé¿å…è¯­éŸ³è¯†åˆ«APIçš„å¤æ‚æ€§ï¼‰
        function playVoicePrompt() {
            if (!audioContext) return;
            
            const voiceGain = document.getElementById('voiceVolume').value / 100;
            if (voiceGain <= 0) return;
            
            // æ’­æ”¾æŸ”å’Œçš„æç¤ºéŸ³ä½œä¸ºå¼€å§‹å¼•å¯¼
            setTimeout(() => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(432, audioContext.currentTime); // å®‡å®™éŸ³
                gain.gain.setValueAtTime(0, audioContext.currentTime);
                gain.gain.linearRampToValueAtTime(voiceGain * 0.2, audioContext.currentTime + 1);
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 4);
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + 4);
            }, 1000);
        }
        
        function stopAllSounds() {
            if (waveNode) {
                try {
                    waveNode.source.stop();
                    waveNode.source.disconnect();
                } catch(e) {}
                waveNode = null;
            }
            
            if (pianoInterval) {
                clearInterval(pianoInterval);
                pianoInterval = null;
            }
            
            if (voiceTimeout) {
                clearTimeout(voiceTimeout);
                voiceTimeout = null;
            }
        }
        
        function updateVolume(type, value) {
            if (type === 'wave' && waveNode) {
                waveNode.gain.gain.setValueAtTime(value / 100, audioContext.currentTime);
            }
        }
        
        function changeLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const t = translations[lang];
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (t[key]) el.textContent = t[key];
            });
            
            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (t[key]) el.placeholder = t[key];
            });
            
            if (lang === 'ar') {
                document.body.style.direction = 'rtl';
            } else {
                document.body.style.direction = 'ltr';
            }
        }
        
        function selectScene(scene, element) {
            currentScene = scene;
            document.querySelectorAll('.scene-card').forEach(card => card.classList.remove('active'));
            element.classList.add('active');
            
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œåˆ‡æ¢åœºæ™¯éŸ³ä¹
            if (isRunning) {
                if (pianoInterval) {
                    clearInterval(pianoInterval);
                    startPianoMusic();
                }
            }
        }
        
        function setTimer(minutes) {
            if (isRunning) toggleTimer();
            timeLeft = minutes * 60;
            updateTimerDisplay();
            
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function toggleTimer() {
            initAudio(); // ç¡®ä¿éŸ³é¢‘ä¸Šä¸‹æ–‡å·²åˆå§‹åŒ–
            
            const btn = document.getElementById('startBtn');
            const statusEl = document.getElementById('audioStatus');
            
            if (isRunning) {
                // æš‚åœ
                clearInterval(timerInterval);
                stopAllSounds();
                isRunning = false;
                btn.innerHTML = `<span data-lang="start">${translations[currentLang].start}</span>`;
                statusEl.textContent = translations[currentLang].ready;
                statusEl.classList.remove('playing');
            } else {
                // å¼€å§‹
                if (!currentScene) {
                    alert(currentLang === 'zh' ? 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåœºæ™¯' : 'Please select a scene first');
                    return;
                }
                
                isRunning = true;
                btn.innerHTML = `<span data-lang="pause">${translations[currentLang].pause}</span>`;
                statusEl.textContent = translations[currentLang].playing;
                statusEl.classList.add('playing');
                
                // æ’­æ”¾å£°éŸ³
                createWaveSound();
                startPianoMusic();
                playVoicePrompt();
                
                // å€’è®¡æ—¶
                timerInterval = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        updateTimerDisplay();
                    } else {
                        // ç»“æŸ
                        clearInterval(timerInterval);
                        stopAllSounds();
                        isRunning = false;
                        alert(currentLang === 'zh' ? 'æ”¾æ¾æ—¶é—´ç»“æŸï¼' : 'Time is up!');
                        btn.innerHTML = `<span data-lang="start">${translations[currentLang].start}</span>`;
                        statusEl.textContent = translations[currentLang].ready;
                        statusEl.classList.remove('playing');
                    }
                }, 1000);
            }
        }
        
        function adminLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'Laoban' && password === 'MMpiano260218**') {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminName').textContent = username;
                localStorage.setItem('adminSession', Date.now());
            } else {
                alert(currentLang === 'zh' ? 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' : 'Invalid credentials');
            }
        }
        
        function adminLogout() {
            document.getElementById('adminLogin').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            localStorage.removeItem('adminSession');
        }
        
        function viewData() {
            window.open('https://sheets.google.com', '_blank');
        }
        
        window.onload = function() {
            const session = localStorage.getItem('adminSession');
            if (session && (Date.now() - session) < 24 * 60 * 60 * 1000) {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminName').textContent = 'Laoban';
            }
        };
    </script>
</body>
</html>