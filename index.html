<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’¢ç´æµ· - Piano Sea</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        .container { max-width: 100%; padding: 20px; padding-bottom: 180px; }
        header { text-align: center; padding: 30px 0 15px; }
        h1 {
            font-size: 2.2em; margin-bottom: 5px;
            background: linear-gradient(to right, #fff, #e0e0e0);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .subtitle { font-size: 1em; opacity: 0.9; }

        .alert-box {
            background: rgba(255,200,100,0.2); border: 1px solid rgba(255,200,100,0.5);
            border-radius: 10px; padding: 12px; margin: 10px 0;
            font-size: 0.85em; text-align: center;
        }

        .ocean-selector {
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            border-radius: 15px; padding: 15px; margin: 15px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .selector-title { font-size: 0.9em; margin-bottom: 10px; opacity: 0.9; }
        .wave-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .wave-btn {
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3);
            color: white; padding: 10px 5px; border-radius: 12px; cursor: pointer;
            transition: all 0.3s; font-size: 0.8em; text-align: center;
        }
        .wave-btn.active { background: rgba(102, 126, 234, 0.6); border-color: white; }
        .wave-icon { font-size: 1.8em; display: block; margin-bottom: 4px; }

        .lang-switcher {
            display: flex; justify-content: center; gap: 8px; margin: 15px 0; flex-wrap: wrap;
        }
        .lang-btn {
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3);
            color: white; padding: 6px 12px; border-radius: 15px; cursor: pointer;
            font-size: 0.9em; transition: all 0.3s;
        }
        .lang-btn.active { background: rgba(102, 126, 234, 0.6); border-color: white; }

        .scene-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .scene-card {
            background: rgba(255,255,255,0.1); border-radius: 15px;
            padding: 15px 10px; border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .scene-card.active { background: rgba(102, 126, 234, 0.5); border-color: white; }
        .scene-icon { font-size: 2.2em; margin-bottom: 5px; }
        .scene-title { font-size: 1em; font-weight: 600; margin-bottom: 3px; }
        .scene-duration { font-size: 0.75em; opacity: 0.8; }

        .guide-section {
            background: rgba(0,0,0,0.2); border-radius: 15px;
            padding: 15px; margin: 15px 0; text-align: center;
        }
        .guide-status {
            font-size: 0.9em; margin-bottom: 10px; padding: 10px;
            background: rgba(255,255,255,0.1); border-radius: 8px;
        }
        .play-guide-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; color: white; padding: 12px 30px;
            border-radius: 25px; cursor: pointer; font-size: 1em;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .player-controls {
            background: rgba(0,0,0,0.4); backdrop-filter: blur(20px);
            position: fixed; bottom: 0; left: 0; right: 0;
            padding: 15px; border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
        }
        .timer-display { font-size: 2.2em; text-align: center; margin-bottom: 10px; }
        .controls-main {
            display: flex; justify-content: center; align-items: center; gap: 20px;
            margin-bottom: 10px;
        }
        .btn-play {
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; color: white; font-size: 1.5em; cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
        }
        .btn-control {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3);
            color: white; width: 45px; height: 45px; border-radius: 50%;
            cursor: pointer; font-size: 1.1em;
        }
        .volume-controls {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
        }
        .vol-item { text-align: center; }
        .vol-label { font-size: 0.8em; margin-bottom: 5px; }
        input[type="range"] {
            width: 100%; height: 5px; border-radius: 3px;
            background: rgba(255,255,255,0.2); outline: none; -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 15px; height: 15px; border-radius: 50%;
            background: white; cursor: pointer;
        }

        #feedback-btn {
            position: fixed; bottom: 160px; right: 15px; width: 50px; height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; text-decoration: none; font-size: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            z-index: 9999;
        }

        .status-indicator {
            display: inline-block; width: 8px; height: 8px;
            border-radius: 50%; margin-right: 5px;
        }
        .status-ok { background: #4ade80; }
        .status-error { background: #f87171; }
        .status-loading { background: #fbbf24; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¹ é’¢ç´æµ·</h1>
            <p class="subtitle" data-lang="subtitle">ä¸€é”®æ”¾æ¾ï¼Œä¸æµ·å…±ç”Ÿ</p>
        </header>

        <div class="alert-box" id="audioAlert">
            <strong>âš ï¸ éŸ³é¢‘ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
            è¯·å°†æ‚¨çš„éŸ³é¢‘æ–‡ä»¶æ”¾å…¥ <code>audio/</code> æ–‡ä»¶å¤¹ï¼š<br>
            â€¢ æµ·æµªå£°ï¼šaudio/wave.mp3<br>
            â€¢ è¯­éŸ³å¼•å¯¼ï¼šaudio/ç„¦è™‘æ€¥æ•‘-æ™®é€šè¯.mp3<br>
            â€¢ é’¢ç´æ›²ï¼šåœ¨çº¿è‡ªåŠ¨åŠ è½½
        </div>

        <div class="ocean-selector">
            <div class="selector-title">ğŸŒŠ <span data-lang="selectWave">é€‰æ‹©æµ·æµªé£æ ¼</span></div>
            <div class="wave-options">
                <button class="wave-btn active" onclick="selectOcean('mediterranean')">
                    <span class="wave-icon">ğŸŒ…</span>
                    <div data-lang="ocean1">åœ°ä¸­æµ·</div>
                </button>
                <button class="wave-btn" onclick="selectOcean('atlantic')">
                    <span class="wave-icon">ğŸŒŠ</span>
                    <div data-lang="ocean2">å¤§è¥¿æ´‹</div>
                </button>
                <button class="wave-btn" onclick="selectOcean('pacific')">
                    <span class="wave-icon">ğŸï¸</span>
                    <div data-lang="ocean3">å¤ªå¹³æ´‹</div>
                </button>
            </div>
        </div>

        <div class="lang-switcher">
            <button class="lang-btn active" onclick="changeLang('zh')">ğŸ‡¨ğŸ‡³ æ™®é€šè¯</button>
            <button class="lang-btn" onclick="changeLang('hk')">ğŸ‡­ğŸ‡° ç²¤è¯­</button>
            <button class="lang-btn" onclick="changeLang('en')">ğŸ‡¬ğŸ‡§ English</button>
            <button class="lang-btn" onclick="changeLang('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
            <button class="lang-btn" onclick="changeLang('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        </div>

        <div class="scene-grid">
            <div class="scene-card active" onclick="selectScene(0, 'anxiety')">
                <div class="scene-icon">ğŸ§˜</div>
                <div class="scene-title" data-lang="scene1">ç„¦è™‘æ€¥æ•‘</div>
                <div class="scene-duration">2-3åˆ†é’Ÿ</div>
            </div>
            <div class="scene-card" onclick="selectScene(1, 'focus')">
                <div class="scene-icon">ğŸ¯</div>
                <div class="scene-title" data-lang="scene2">é™å¿ƒä¸“æ³¨</div>
                <div class="scene-duration">1åˆ†é’Ÿ</div>
            </div>
            <div class="scene-card" onclick="selectScene(2, 'sleep')">
                <div class="scene-icon">ğŸŒ™</div>
                <div class="scene-title" data-lang="scene3">ç¡å‰åŠ©çœ </div>
                <div class="scene-duration">3-5åˆ†é’Ÿ</div>
            </div>
            <div class="scene-card" onclick="selectScene(3, 'nap')">
                <div class="scene-icon">ğŸ˜´</div>
                <div class="scene-title" data-lang="scene4">åˆä¼‘å°æ†©</div>
                <div class="scene-duration">3åˆ†é’Ÿ</div>
            </div>
        </div>

        <div class="guide-section">
            <div class="guide-status" id="guideStatus">
                <span class="status-indicator" id="voiceStatus"></span>
                <span id="statusText">å‡†å¤‡å°±ç»ª - ç‚¹å‡»æ’­æ”¾å¼€å§‹</span>
            </div>
            <button class="play-guide-btn" onclick="startSession()" id="mainPlayBtn">
                â–¶ï¸ <span data-lang="start">å¼€å§‹æ”¾æ¾</span>
            </button>
        </div>
    </div>

    <div class="player-controls">
        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="controls-main">
            <button class="btn-control" onclick="stopAll()">â¹</button>
            <button class="btn-play" id="playPauseBtn" onclick="togglePlay()">â–¶</button>
            <button class="btn-control" onclick="toggleMute()">ğŸ”Š</button>
        </div>
        <div class="volume-controls">
            <div class="vol-item">
                <div class="vol-label">ğŸ¹ é’¢ç´</div>
                <input type="range" id="volPiano" min="0" max="100" value="60" oninput="updateVolume()">
            </div>
            <div class="vol-item">
                <div class="vol-label">ğŸŒŠ æµ·æµª</div>
                <input type="range" id="volWave" min="0" max="100" value="50" oninput="updateVolume()">
            </div>
            <div class="vol-item">
                <div class="vol-label">ğŸ™ï¸ è¯­éŸ³</div>
                <input type="range" id="volVoice" min="0" max="100" value="80" oninput="updateVolume()">
            </div>
        </div>
    </div>

    <a href="https://forms.gle/r6znYF8Pr5ffVmAv9" target="_blank" id="feedback-btn">ğŸ’¬</a>

    <script>
        // åœºæ™¯é…ç½®ï¼ˆæ˜ å°„åˆ°æ‚¨çš„æ–‡ä»¶åï¼‰
        const scenes = {
            anxiety: { name: 'ç„¦è™‘æ€¥æ•‘', duration: 180, piano: 'calm' },
            focus: { name: 'é™å¿ƒä¸“æ³¨', duration: 60, piano: 'focus' },
            sleep: { name: 'ç¡å‰åŠ©çœ ', duration: 300, piano: 'sleep' },
            nap: { name: 'åˆä¼‘å°æ†©', duration: 180, piano: 'nap' }
        };

        // è¯­è¨€æ˜ å°„
        const langMap = {
            'zh': 'æ™®é€šè¯', 'hk': 'ç²¤è¯­', 'en': 'è‹±è¯­', 'es': 'è¥¿ç­ç‰™è¯­', 'ar': 'é˜¿æ‹‰ä¼¯è¯­'
        };

        // åœ¨çº¿é’¢ç´éŸ³ä¹æºï¼ˆä½œä¸ºå¤‡é€‰ï¼‰
        const pianoTracks = {
            calm: 'https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3',
            focus: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3',
            sleep: 'https://cdn.pixabay.com/download/audio/2021/11/25/audio_66b06d3e32.mp3',
            nap: 'https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3'
        };

        // çŠ¶æ€
        let currentScene = 'anxiety';
        let currentLang = 'zh';
        let currentOcean = 'mediterranean';
        let isPlaying = false;
        let isMuted = false;

        // éŸ³é¢‘å¯¹è±¡
        let waveAudio = new Audio();
        let voiceAudio = new Audio();
        let pianoAudio = new Audio();

        waveAudio.loop = true;
        pianoAudio.loop = true;

        // æ–‡ä»¶è·¯å¾„æ„å»º
        function getVoicePath(scene, lang) {
            return `audio/${scenes[scene].name}-${langMap[lang]}.mp3`;
        }

        function getWavePath() {
            // ä¼˜å…ˆä½¿ç”¨ wave.mp3ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨åœ¨çº¿å¤‡é€‰
            return 'audio/wave.mp3';
        }

        // é€‰æ‹©åœºæ™¯
        function selectScene(index, sceneKey) {
            currentScene = sceneKey;
            document.querySelectorAll('.scene-card').forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });
            updateStatus(`å·²é€‰æ‹©ï¼š${scenes[sceneKey].name} (${langMap[currentLang]})`);
        }

        // é€‰æ‹©æµ·åŸŸ
        function selectOcean(ocean) {
            currentOcean = ocean;
            document.querySelectorAll('.wave-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // è®¾ç½®æµ·æµªå‚æ•°
            const settings = {
                mediterranean: { rate: 0.9, vol: 0.4 },
                atlantic: { rate: 1.0, vol: 0.5 },
                pacific: { rate: 1.1, vol: 0.45 }
            };

            waveAudio.playbackRate = settings[ocean].rate;
            waveAudio.volume = settings[ocean].vol * (document.getElementById('volWave').value / 100);

            updateStatus(`æµ·æµªåˆ‡æ¢ï¼š${event.currentTarget.innerText.trim()}`);
        }

        // è¯­è¨€åˆ‡æ¢
        function changeLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateStatus(`è¯­è¨€ï¼š${langMap[lang]}`);
        }

        // å¼€å§‹å®Œæ•´ä¼šè¯
        async function startSession() {
            if (isPlaying) {
                stopAll();
                return;
            }

            updateStatus('æ­£åœ¨åŠ è½½éŸ³é¢‘...', 'loading');

            try {
                // 1. åŠ è½½æµ·æµªå£°ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
                waveAudio.src = getWavePath();
                waveAudio.volume = 0.5 * (document.getElementById('volWave').value / 100);

                // 2. åŠ è½½è¯­éŸ³å¼•å¯¼ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
                const voicePath = getVoicePath(currentScene, currentLang);
                voiceAudio.src = voicePath;
                voiceAudio.volume = document.getElementById('volVoice').value / 100;

                // 3. åŠ è½½é’¢ç´æ›²ï¼ˆåœ¨çº¿ï¼‰
                pianoAudio.src = pianoTracks[scenes[currentScene].piano];
                pianoAudio.volume = 0.6 * (document.getElementById('volPiano').value / 100);

                // æ’­æ”¾æ‰€æœ‰éŸ³é¢‘
                await Promise.all([
                    waveAudio.play().catch(e => console.log('æµ·æµªå£°åŠ è½½å¤±è´¥:', e)),
                    voiceAudio.play().catch(e => {
                        console.log('è¯­éŸ³åŠ è½½å¤±è´¥:', e);
                        updateStatus('âš ï¸ æœªæ‰¾åˆ°æœ¬åœ°è¯­éŸ³æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ audio/ æ–‡ä»¶å¤¹', 'error');
                    }),
                    pianoAudio.play().catch(e => console.log('é’¢ç´åŠ è½½å¤±è´¥:', e))
                ]);

                isPlaying = true;
                document.getElementById('mainPlayBtn').innerHTML = 'â¸ï¸ æš‚åœ';
                document.getElementById('playPauseBtn').textContent = 'â¸';
                updateStatus('âœ… æ­£åœ¨æ’­æ”¾ï¼š' + scenes[currentScene].name, 'ok');

                // è¯­éŸ³ç»“æŸåç»§ç»­æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                voiceAudio.onended = () => {
                    updateStatus('è¯­éŸ³å¼•å¯¼ç»“æŸ - ç»§ç»­æ’­æ”¾èƒŒæ™¯éŸ³ä¹', 'ok');
                };

            } catch (err) {
                updateStatus('âŒ æ’­æ”¾å¤±è´¥ï¼š' + err.message, 'error');
                console.error(err);
            }
        }

        // æ§åˆ¶å‡½æ•°
        function togglePlay() {
            if (isPlaying) {
                waveAudio.pause();
                voiceAudio.pause();
                pianoAudio.pause();
                isPlaying = false;
                document.getElementById('playPauseBtn').textContent = 'â–¶';
                document.getElementById('mainPlayBtn').innerHTML = 'â–¶ï¸ ç»§ç»­';
                updateStatus('å·²æš‚åœ');
            } else {
                startSession();
            }
        }

        function stopAll() {
            waveAudio.pause();
            voiceAudio.pause();
            pianoAudio.pause();
            waveAudio.currentTime = 0;
            voiceAudio.currentTime = 0;
            pianoAudio.currentTime = 0;
            isPlaying = false;
            document.getElementById('playPauseBtn').textContent = 'â–¶';
            document.getElementById('mainPlayBtn').innerHTML = 'â–¶ï¸ å¼€å§‹æ”¾æ¾';
            updateStatus('å·²åœæ­¢');
        }

        function toggleMute() {
            isMuted = !isMuted;
            waveAudio.muted = isMuted;
            voiceAudio.muted = isMuted;
            pianoAudio.muted = isMuted;
            event.target.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        }

        function updateVolume() {
            if (!isPlaying) return;
            pianoAudio.volume = document.getElementById('volPiano').value / 100;
            waveAudio.volume = document.getElementById('volWave').value / 100;
            voiceAudio.volume = document.getElementById('volVoice').value / 100;
        }

        function updateStatus(text, type = '') {
            const statusEl = document.getElementById('statusText');
            const indicator = document.getElementById('voiceStatus');
            statusEl.textContent = text;

            indicator.className = 'status-indicator';
            if (type === 'ok') indicator.classList.add('status-ok');
            else if (type === 'error') indicator.classList.add('status-error');
            else if (type === 'loading') indicator.classList.add('status-loading');
        }

        // éŸ³é¢‘é”™è¯¯å¤„ç†
        waveAudio.onerror = () => {
            console.log('æµ·æµªéŸ³é¢‘é”™è¯¯ï¼Œåˆ‡æ¢åˆ°åœ¨çº¿å¤‡é€‰');
            waveAudio.src = 'https://cdn.pixabay.com/download/audio/2021/09/06/audio_278d3d5949.mp3';
            waveAudio.play().catch(e => console.log('åœ¨çº¿æµ·æµªä¹Ÿå¤±è´¥'));
        };

        voiceAudio.onerror = () => {
            updateStatus('âŒ è¯­éŸ³æ–‡ä»¶æœªæ‰¾åˆ°ï¼š' + getVoicePath(currentScene, currentLang), 'error');
        };

        // åˆå§‹åŒ–
        window.onload = () => {
            updateStatus('è¯·ç‚¹å‡»"å¼€å§‹æ”¾æ¾"æ’­æ”¾éŸ³é¢‘');
        };
    </script>
</body>
</html>