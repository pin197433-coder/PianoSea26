<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’¢ç´æµ· - Piano Sea</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            padding-bottom: 220px;
        }
        .container { max-width: 100%; padding: 20px; }
        header { text-align: center; padding: 20px 0; }
        h1 { font-size: 2em; margin-bottom: 5px; }

        .card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            width: calc(100% - 10px);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            font-size: 0.9em;
            padding: 8px 20px;
        }

        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 10px 0; }
        .item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .item.active {
            border-color: white;
            background: rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }

        .status {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .track-info {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .error { color: #ff6b6b; font-size: 0.85em; margin-top: 5px; }
        .success { color: #4ade80; font-size: 0.85em; margin-top: 5px; }

        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            z-index: 1000;
        }

        .timer { font-size: 2.5em; text-align: center; margin-bottom: 10px; }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1.2em;
            cursor: pointer;
        }

        .play-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-size: 1.5em;
        }

        .volume-container {
            display: flex;
            gap: 10px;
            justify-content: space-around;
        }

        .volume-item {
            flex: 1;
            text-align: center;
        }

        input[type="range"] { width: 100%; margin-top: 5px; }

        .badge {
            display: inline-block;
            background: rgba(102, 126, 234, 0.8);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-left: 5px;
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¹ é’¢ç´æµ·</h1>
            <p>ä¸€é”®æ”¾æ¾ï¼Œä¸æµ·å…±ç”Ÿ</p>
        </header>

        <div class="card">
            <div style="font-weight: bold; margin-bottom: 10px;">ğŸŒŠ é€‰æ‹©æµ·åŸŸ</div>
            <div class="grid">
                <div class="item active" onclick="setOcean('mediterranean')">åœ°ä¸­æµ·<br><small>è½»æŸ”</small></div>
                <div class="item" onclick="setOcean('atlantic')">å¤§è¥¿æ´‹<br><small>èˆ’ç¼“</small></div>
                <div class="item" onclick="setOcean('pacific')">å¤ªå¹³æ´‹<br><small>æ²»æ„ˆ</small></div>
            </div>
        </div>

        <div class="card">
            <div style="font-weight: bold; margin-bottom: 10px;">ğŸ­ é€‰æ‹©åœºæ™¯ <span class="badge">å¤šæ›²ç›®</span></div>
            <div class="grid">
                <div class="item active" onclick="setScene('anxiety')">ç„¦è™‘æ€¥æ•‘<br><small>6é¦–å¯é€‰</small></div>
                <div class="item" onclick="setScene('focus')">é™å¿ƒä¸“æ³¨<br><small>4é¦–å¯é€‰</small></div>
                <div class="item" onclick="setScene('sleep')">ç¡å‰åŠ©çœ <br><small>5é¦–å¯é€‰</small></div>
                <div class="item" onclick="setScene('nap')">åˆä¼‘å°æ†©<br><small>4é¦–å¯é€‰</small></div>
            </div>
        </div>

        <div class="card">
            <div style="font-weight: bold; margin-bottom: 10px;">ğŸŒ é€‰æ‹©è¯­è¨€</div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" style="flex: 1; min-width: 80px;" onclick="setLang('zh')">æ™®é€šè¯</button>
                <button class="btn" style="flex: 1; min-width: 80px;" onclick="setLang('hk')">ç²¤è¯­</button>
                <button class="btn" style="flex: 1; min-width: 80px;" onclick="setLang('en')">English</button>
            </div>
        </div>

        <div class="card">
            <div class="track-info">
                <span>ğŸ¹ å½“å‰é’¢ç´æ›²ï¼š<span id="currentTrack">æœªæ’­æ”¾</span></span>
                <button class="btn-secondary" onclick="nextPiano()">æ¢ä¸€é¦– â†»</button>
            </div>

            <div class="status" id="statusText">å‡†å¤‡å°±ç»ª - ç‚¹å‡»"å¼€å§‹"æ’­æ”¾</div>
            <div id="errorText" class="error"></div>
            <div id="successText" class="success"></div>

            <button class="btn" id="mainBtn" onclick="togglePlay()" style="margin-top: 10px;">
                â–¶ï¸ å¼€å§‹æ”¾æ¾
            </button>
        </div>
    </div>

    <div class="player">
        <div class="timer" id="timerDisplay">15:00</div>
        <div class="controls">
            <button class="control-btn" onclick="stopAll()">â¹</button>
            <button class="control-btn play-btn" id="playBtn" onclick="togglePlay()">â–¶</button>
            <button class="control-btn" onclick="toggleMute()">ğŸ”Š</button>
        </div>
        <div class="volume-container">
            <div class="volume-item">
                <div>ğŸ¹ é’¢ç´</div>
                <input type="range" id="volPiano" min="0" max="100" value="70" oninput="updateVolumes()">
            </div>
            <div class="volume-item">
                <div>ğŸŒŠ æµ·æµª</div>
                <input type="range" id="volWave" min="0" max="100" value="50" oninput="updateVolumes()">
            </div>
            <div class="volume-item">
                <div>ğŸ™ï¸ è¯­éŸ³</div>
                <input type="range" id="volVoice" min="0" max="100" value="80" oninput="updateVolumes()">
            </div>
        </div>
    </div>

    <script>
        // ===== éŸ³é¢‘æ–‡ä»¶é…ç½® =====
        // 1. æœ¬åœ°é’¢ç´æ–‡ä»¶ï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼Œæ”¯æŒå¤šé¦–éšæœºæ’­æ”¾ï¼‰
        const PIANO_FILES = {
            sleep: [  // ç¡å‰åŠ©çœ  - 5é¦–
                'piano_sleep_SoftPiano2.mp3',
                'piano_sleep_SoftPiano.mp3',
                'piano_sleep_MidnightRide.mp3',
                'piano_sleep_meditationRelax.mp3',
                'piano_sleep_daylight.mp3'
            ],
            nap: [    // åˆä¼‘å°æ†© - 4é¦–
                'piano_nap_nostalgic.mp3',
                'piano_nap_morningZen.mp3',
                'piano_nap_Inspiring.mp3',
                'piano_nap_cafeJazz.mp3'
            ],
            focus: [  // é™å¿ƒä¸“æ³¨ - 4é¦–
                'piano_focus_variatio14a2clav.mp3',
                'piano_focus_scarboroughFair.mp3',
                'piano_focus_minimalisticPrelude.mp3',
                'piano_focus_innerVoices.mp3'
            ],
            anxiety: [ // ç„¦è™‘æ€¥æ•‘ - 6é¦–
                'piano_anxiety_soothingPiano.mp3',
                'piano_anxiety_SoftPiano.mp3',
                'piano_anxiety_romanticMemories.mp3',
                'piano_anxiety_melodiesEmbrace.mp3',
                'piano_anxiety_emotional.mp3',
                'piano_anxiety_CalmWaves.mp3'
            ]
        };

        // 2. æœ¬åœ°æµ·æµªæ–‡ä»¶
        const WAVE_FILES = {
            mediterranean: 'audio/wave1.mp3',
            atlantic: 'audio/wave2.mp3',
            pacific: 'audio/wave3.mp3'
        };

        // 3. æœ¬åœ°è¯­éŸ³æ–‡ä»¶
        const VOICE_FILES = {
            anxiety: { zh: 'audio/ç„¦è™‘æ€¥æ•‘-æ™®é€šè¯.mp3', hk: 'audio/ç„¦è™‘æ€¥æ•‘-ç²¤è¯­.mp3', en: 'audio/ç„¦è™‘æ€¥æ•‘-è‹±è¯­.mp3' },
            focus: { zh: 'audio/é™å¿ƒä¸“æ³¨-æ™®é€šè¯.mp3', hk: 'audio/é™å¿ƒä¸“æ³¨-ç²¤è¯­.mp3', en: 'audio/é™å¿ƒä¸“æ³¨-è‹±è¯­.mp3' },
            sleep: { zh: 'audio/ç¡å‰åŠ©çœ -æ™®é€šè¯.mp3', hk: 'audio/ç¡å‰åŠ©çœ -ç²¤è¯­.mp3', en: 'audio/ç¡å‰åŠ©çœ -è‹±è¯­.mp3' },
            nap: { zh: 'audio/åˆä¼‘å°æ†©-æ™®é€šè¯.mp3', hk: 'audio/åˆä¼‘å°æ†©-ç²¤è¯­.mp3', en: 'audio/åˆä¼‘å°æ†©-è‹±è¯­.mp3' }
        };

        let state = {
            isPlaying: false,
            isMuted: false,
            ocean: 'mediterranean',
            scene: 'anxiety',
            lang: 'zh',
            currentPianoIndex: 0
        };

        let audio = {};
        let timer = null;
        let remaining = 15 * 60;

        // è·å–å½“å‰åœºæ™¯çš„éšæœºé’¢ç´æ›²
        function getRandomPiano(scene) {
            const files = PIANO_FILES[scene];
            const randomIndex = Math.floor(Math.random() * files.length);
            state.currentPianoIndex = randomIndex;
            return 'audio/' + files[randomIndex];
        }

        // è·å–ä¸‹ä¸€é¦–é’¢ç´æ›²
        function nextPiano() {
            const files = PIANO_FILES[state.scene];
            state.currentPianoIndex = (state.currentPianoIndex + 1) % files.length;
            const nextFile = 'audio/' + files[state.currentPianoIndex];

            // æ›´æ–°æ˜¾ç¤º
            updateTrackDisplay();

            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œåˆ‡æ¢åˆ°æ–°æ›²ç›®
            if (state.isPlaying && audio.piano) {
                audio.piano.src = nextFile;
                audio.piano.play().catch(() => {});
            }

            showSuccess('å·²åˆ‡æ¢åˆ°ï¼š' + files[state.currentPianoIndex].replace('.mp3', ''));
        }

        // æ›´æ–°æ›²ç›®æ˜¾ç¤º
        function updateTrackDisplay() {
            const files = PIANO_FILES[state.scene];
            const currentFile = files[state.currentPianoIndex];
            document.getElementById('currentTrack').textContent = 
                currentFile.replace('piano_' + state.scene + '_', '').replace('.mp3', '') + 
                ' (' + (state.currentPianoIndex + 1) + '/' + files.length + ')';
        }

        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            // 1. é’¢ç´ï¼ˆéšæœºé€‰æ‹©ä¸€é¦–ï¼‰
            if (!audio.piano) {
                const pianoSrc = getRandomPiano(state.scene);
                audio.piano = new Audio(pianoSrc);
                audio.piano.loop = true;
                audio.piano.volume = document.getElementById('volPiano').value / 100;
                updateTrackDisplay();
            }

            // 2. æµ·æµª
            if (!audio.wave) {
                audio.wave = new Audio(WAVE_FILES[state.ocean]);
                audio.wave.loop = true;
                audio.wave.volume = document.getElementById('volWave').value / 100;
            }

            // 3. è¯­éŸ³
            if (!audio.voice) {
                audio.voice = new Audio(VOICE_FILES[state.scene][state.lang]);
                audio.voice.volume = document.getElementById('volVoice').value / 100;
            }
        }

        // æ’­æ”¾æ§åˆ¶
        function togglePlay() {
            if (state.isPlaying) {
                pauseAll();
                state.isPlaying = false;
                updateUI();
                clearInterval(timer);
                return;
            }

            showError('');
            initAudio();

            // æ’­æ”¾æ‰€æœ‰éŸ³è½¨
            Promise.all([
                audio.piano.play().catch(e => { showError('é’¢ç´æ’­æ”¾å¤±è´¥ï¼š' + e.message); return false; }),
                audio.wave.play().catch(e => { showError('æµ·æµªæ’­æ”¾å¤±è´¥ï¼š' + e.message); return false; }),
                audio.voice.play().catch(e => { showError('è¯­éŸ³æ’­æ”¾å¤±è´¥ï¼š' + e.message); return false; })
            ]).then(results => {
                if (results.every(r => r !== false)) {
                    state.isPlaying = true;
                    updateUI();
                    startTimer();
                    showSuccess('å¼€å§‹æ’­æ”¾ï¼å½“å‰é’¢ç´æ›²ï¼š' + PIANO_FILES[state.scene][state.currentPianoIndex].replace('.mp3', ''));
                }
            });
        }

        function pauseAll() {
            if (audio.piano) audio.piano.pause();
            if (audio.wave) audio.wave.pause();
            if (audio.voice) audio.voice.pause();
        }

        function stopAll() {
            pauseAll();
            if (audio.piano) { audio.piano.currentTime = 0; audio.piano = null; }
            if (audio.wave) { audio.wave.currentTime = 0; audio.wave = null; }
            if (audio.voice) { audio.voice.currentTime = 0; audio.voice = null; }
            state.isPlaying = false;
            remaining = 15 * 60;
            updateTimer();
            updateUI();
            clearInterval(timer);
            document.getElementById('currentTrack').textContent = 'æœªæ’­æ”¾';
        }

        function toggleMute() {
            state.isMuted = !state.isMuted;
            Object.values(audio).forEach(a => { if (a) a.muted = state.isMuted; });
        }

        function updateVolumes() {
            if (audio.piano) audio.piano.volume = document.getElementById('volPiano').value / 100;
            if (audio.wave) audio.wave.volume = document.getElementById('volWave').value / 100;
            if (audio.voice) audio.voice.volume = document.getElementById('volVoice').value / 100;
        }

        // åœºæ™¯åˆ‡æ¢
        function setOcean(ocean) {
            state.ocean = ocean;
            updateSelection();
            if (audio.wave) {
                const wasPlaying = state.isPlaying;
                audio.wave.src = WAVE_FILES[ocean];
                if (wasPlaying) audio.wave.play().catch(() => {});
            }
            updateStatus();
        }

        function setScene(scene) {
            state.scene = scene;
            state.currentPianoIndex = 0; // é‡ç½®ä¸ºéšæœºé€‰æ‹©
            updateSelection();

            // é‡æ–°åŠ è½½é’¢ç´å’Œè¯­éŸ³
            if (audio.piano) audio.piano = null;
            if (audio.voice) audio.voice = null;

            if (state.isPlaying) {
                stopAll();
                setTimeout(togglePlay, 300);
            } else {
                // é¢„åŠ è½½æ˜¾ç¤ºæ›²ç›®å
                const files = PIANO_FILES[scene];
                const randomIndex = Math.floor(Math.random() * files.length);
                state.currentPianoIndex = randomIndex;
                updateTrackDisplay();
            }
            updateStatus();
        }

        function setLang(lang) {
            state.lang = lang;
            if (audio.voice) audio.voice = null;
            if (state.isPlaying) {
                stopAll();
                setTimeout(togglePlay, 300);
            }
            updateStatus();
        }

        function updateSelection() {
            // ç®€åŒ–å¤„ç†ï¼šç”¨æˆ·ç‚¹å‡»åè§†è§‰ä¸Šå·²æ›´æ–°ï¼Œè¿™é‡Œåªæ›´æ–°çŠ¶æ€
            document.querySelectorAll('.item').forEach((el, idx) => {
                el.classList.remove('active');
                // æ ¹æ®å½“å‰çŠ¶æ€é‡æ–°æ ‡è®°activeï¼ˆç®€åŒ–é€»è¾‘ï¼‰
                const scenes = ['anxiety', 'focus', 'sleep', 'nap'];
                const oceans = ['mediterranean', 'atlantic', 'pacific'];

                if (idx < 3 && oceans[idx] === state.ocean) el.classList.add('active');
                if (idx >= 3 && scenes[idx-3] === state.scene) el.classList.add('active');
            });
        }

        // è®¡æ—¶å™¨
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                remaining--;
                updateTimer();
                if (remaining <= 0) {
                    stopAll();
                    alert('æ”¾æ¾æ—¶é—´ç»“æŸï¼');
                }
            }, 1000);
        }

        function updateTimer() {
            const m = Math.floor(remaining / 60).toString().padStart(2, '0');
            const s = (remaining % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `${m}:${s}`;
        }

        function updateStatus() {
            const names = {
                ocean: { mediterranean: 'åœ°ä¸­æµ·', atlantic: 'å¤§è¥¿æ´‹', pacific: 'å¤ªå¹³æ´‹' },
                scene: { anxiety: 'ç„¦è™‘æ€¥æ•‘', focus: 'é™å¿ƒä¸“æ³¨', sleep: 'ç¡å‰åŠ©çœ ', nap: 'åˆä¼‘å°æ†©' },
                lang: { zh: 'æ™®é€šè¯', hk: 'ç²¤è¯­', en: 'è‹±è¯­' }
            };
            document.getElementById('statusText').textContent = 
                `${names.ocean[state.ocean]} | ${names.scene[state.scene]} | ${names.lang[state.lang]}`;
        }

        function updateUI() {
            document.getElementById('mainBtn').textContent = state.isPlaying ? 'â¸ï¸ æš‚åœæ”¾æ¾' : 'â–¶ï¸ å¼€å§‹æ”¾æ¾';
            document.getElementById('playBtn').textContent = state.isPlaying ? 'â¸' : 'â–¶';
        }

        function showError(msg) { 
            const el = document.getElementById('errorText');
            el.textContent = msg; 
            if (msg) setTimeout(() => el.textContent = '', 5000);
        }
        function showSuccess(msg) { 
            const el = document.getElementById('successText');
            el.textContent = msg; 
            setTimeout(() => el.textContent = '', 3000);
        }

        // åˆå§‹åŒ–
        updateStatus();
        updateTrackDisplay();
    </script>
</body>
</html>